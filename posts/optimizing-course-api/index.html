<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Optimizing Course Search by over 8x &#183; Jake Roggenbuck</title><meta name=title content="Optimizing Course Search by over 8x &#183; Jake Roggenbuck"><meta name=description content="An overview of optimizations I did to a course search app that resulted in over an 8x speed improvement."><meta name=keywords content="optimization,rust,api,"><link rel=canonical href=/posts/optimizing-course-api/><link type=text/css rel=stylesheet href=/css/main.bundle.min.4d4b1b35ed4fb37d198f5f4fa732e64404b535101cdef4401ac22e7c91380b82f3c8e5d51ae61f0149e6a95694c77e5a40943ca8480609a230c10f33c1fc11b4.css integrity="sha512-TUsbNe1Ps30Zj19PpzLmRAS1NRAc3vRAGsIufJE4C4LzyOXVGuYfAUnmqVaUx35aQJQ8qEgGCaIwwQ8zwfwRtA=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.006a5ac4ddc20468d3cbac5f715178db0c4e87ec9673e6f6bc123ea9d5b9368c9c5323358b3f6eb419028d87c3c45a8d704eedbee9458cc2d0596554a058d611.js integrity="sha512-AGpaxN3CBGjTy6xfcVF42wxOh+yWc+b2vBI+qdW5NoycUyM1iz9utBkCjYfDxFqNcE7tvulFjMLQWWVUoFjWEQ==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Optimizing Course Search by over 8x"><meta property="og:description" content="An overview of optimizations I did to a course search app that resulted in over an 8x speed improvement."><meta property="og:type" content="article"><meta property="og:url" content="/posts/optimizing-course-api/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-02T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-02T00:00:00+00:00"><meta property="og:site_name" content="Jake Roggenbuck"><meta name=twitter:card content="summary"><meta name=twitter:title content="Optimizing Course Search by over 8x"><meta name=twitter:description content="An overview of optimizations I did to a course search app that resulted in over an 8x speed improvement."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Optimizing Course Search by over 8x","headline":"Optimizing Course Search by over 8x","description":"An overview of optimizations I did to a course search app that resulted in over an 8x speed improvement.","abstract":"How I rewrote a Python API with over 100,000 weekly endpoint requests (during peak usage) resulting in over an 8x speed improvement.","inLanguage":"en","url":"\/posts\/optimizing-course-api\/","author":{"@type":"Person","name":"Jake Roggenbuck"},"copyrightYear":"2025","dateCreated":"2025-08-02T00:00:00\u002b00:00","datePublished":"2025-08-02T00:00:00\u002b00:00","dateModified":"2025-08-02T00:00:00\u002b00:00","keywords":["optimization","rust","api"],"mainEntityOfPage":"true","wordCount":"2415"}]</script><meta name=author content="Jake Roggenbuck"><link href=mailto:me@jr0.org rel=me><link href=https://github.com/jakeroggenbuck rel=me><link href=https://linkedin.com/in/jakeroggenbuck rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script>
<script defer type=text/javascript src=/js/chart.bundle.e7ec4c191c28a7353139ea29a27e098eec197f578bd4673e669e008359854f8186acd5459b603883f94f0b00eacec8ad9bad45a904eaee8a745c95c86b9a0689.js integrity="sha512-5+xMGRwopzUxOeopon4JjuwZf1eL1Gc+Zp4Ag1mFT4GGrNVFm2A4g/lPCwDqzsitm61FqQTq7op0XJXIa5oGiQ=="></script><meta name=theme-color><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script>!function(e,t){var n,s,o,i;t.__SV||(window.posthog=t,t._i=[],t.init=function(a,r,c){function d(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}(s=e.createElement("script")).type="text/javascript",s.async=!0,s.src=r.api_host+"/static/array.js",(i=e.getElementsByTagName("script")[0]).parentNode.insertBefore(s,i);var l=t;for(void 0!==c?l=t[c]=[]:c="posthog",l.people=l.people||[],l.toString=function(e){var t="posthog";return"posthog"!==c&&(t+="."+c),e||(t+=" (stub)"),t},l.people.toString=function(){return l.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),n=0;n<o.length;n++)d(l,o[n]);t._i.push([a,r,c])},t.__SV=1)}(document,window.posthog||[]),posthog.init("phc_ML7OV6jGM1EXu0tXlV5CUqJgBSduSsgx8U2HaLEiIX",{api_host:"https://app.posthog.com"})</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Jake Roggenbuck</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/projects/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Projects>Projects</p></a><a href=/posts/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>Blog</p></a><a href=/archive/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Archive>Archive</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/projects/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Projects>Projects</p></a></li><li class=mt-1><a href=/posts/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Posts>Blog</p></a></li><li class=mt-1><a href=/archive/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Archive>Archive</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/optimizing-course-api/>Optimizing Course Search by over 8x</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Optimizing Course Search by over 8x</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2025-08-02 00:00:00 +0000 UTC">2 August 2025</time><span class="px-2 text-primary-500">&#183;</span><span>2415 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">12 mins</span></div></div><div class=flex><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Jake Roggenbuck" src=/jake-profile-2_hu5c441416fff170c71d20e1ff858469cd_88398_192x192_fill_q75_box_center.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Jake Roggenbuck</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Working at Capital One as a SWE Intern and Conducting Programming Language Research</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:me@jr0.org target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/jakeroggenbuck target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/jakeroggenbuck target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#background--problem>Background & Problem</a></li><li><a href=#the-optimizations>The Optimizations</a><ul><li><a href=#optimization-1-moving-to-rust>Optimization 1: Moving to Rust</a></li><li><a href=#optimization-2-loading-json-to-memory-at-startup>Optimization 2: Loading JSON to memory at startup</a></li><li><a href=#optimization-3-using-rawjson>Optimization 3: Using RawJson</a></li><li><a href=#optimization-4-gzip-data>Optimization 4: Gzip Data</a></li><li><a href=#optimization-5-preloading-data-into-memory>Optimization 5: Preloading Data Into Memory</a></li></ul></li><li><a href=#bonus-optimization-attempts>Bonus Optimization Attempts</a><ul><li><a href=#attempt-1-using-owned-data>Attempt 1: Using Owned Data</a></li><li><a href=#attempt-2-compiler-flags>Attempt 2: Compiler Flags</a></li></ul></li><li><a href=#methods>Methods</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#final-performance-rankings>Final Performance Rankings</a></li><li><a href=#acknowledgments>Acknowledgments</a></li><li><a href=#notes>Notes</a></li><li><a href=#appendix>Appendix</a><ul><li><a href=#complete-two-sample-t-test-for-optimization-3-usign-rawjson>Complete Two Sample T-Test for Optimization 3. Usign RawJson</a></li><li><a href=#api-routes-requested-by-week>API Routes Requested by Week</a></li><li><a href=#analytics-of-the-course-search>Analytics of the Course Search</a></li></ul></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#background--problem>Background & Problem</a></li><li><a href=#the-optimizations>The Optimizations</a><ul><li><a href=#optimization-1-moving-to-rust>Optimization 1: Moving to Rust</a></li><li><a href=#optimization-2-loading-json-to-memory-at-startup>Optimization 2: Loading JSON to memory at startup</a></li><li><a href=#optimization-3-using-rawjson>Optimization 3: Using RawJson</a></li><li><a href=#optimization-4-gzip-data>Optimization 4: Gzip Data</a></li><li><a href=#optimization-5-preloading-data-into-memory>Optimization 5: Preloading Data Into Memory</a></li></ul></li><li><a href=#bonus-optimization-attempts>Bonus Optimization Attempts</a><ul><li><a href=#attempt-1-using-owned-data>Attempt 1: Using Owned Data</a></li><li><a href=#attempt-2-compiler-flags>Attempt 2: Compiler Flags</a></li></ul></li><li><a href=#methods>Methods</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#final-performance-rankings>Final Performance Rankings</a></li><li><a href=#acknowledgments>Acknowledgments</a></li><li><a href=#notes>Notes</a></li><li><a href=#appendix>Appendix</a><ul><li><a href=#complete-two-sample-t-test-for-optimization-3-usign-rawjson>Complete Two Sample T-Test for Optimization 3. Usign RawJson</a></li><li><a href=#api-routes-requested-by-week>API Routes Requested by Week</a></li><li><a href=#analytics-of-the-course-search>Analytics of the Course Search</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">How I rewrote a Python API with over 100,000 weekly endpoint requests (during peak usage) resulting in over an 8x speed improvement.</div><p>Here is a snapshot into the end results. The left bar shows execution time of the old backend. The right bar shows one of the fastest result of the optimizations presented here.</p><div class=chart><canvas id=chart-2-1757618014866930886></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-2-1757618014866930886"),n=new Chart(t,{type:"bar",data:{labels:["Render","GZIP own 9"],datasets:[{label:"Mean Execution Time (seconds)",data:[6.369174861059873,.7445368937799867],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"Performance Metrics: Mean Execution Time",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.2591171410731346,.11279561023598754],n=t[e.dataIndex];return`Std Dev: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"Routes",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.2591171410731346,.11279561023598754],o=[6.369174861059873,.7445368937799867];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><div id=background--problem class=anchor></div><h2 class="relative group">Background & Problem
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#background--problem aria-label=Anchor>#</a></span></h2><p>In late October of 2024, my team and I started building a course recommendation system that shows grade distributions for UC Davis. Our initial rough version was launched 4 days later on November 2nd. A school year after that, it&rsquo;s been used by 8,500 students, has over 267,000 page views, and our backend has handled over 850,000 requests as of writing.</p><p>Our first versions of the product (weeks 1-2) were objectively slow, taking upwards of 10 seconds to send 4MB of data to the frontend. As soon as we built it, we decided to optimize it because our initial users said they liked the content but it took too long to load on their phones. Those optimizations involved pagination, prefetching data, and upgrading our hosting above the free tier of Render. Having the higher tier also meant our backend would have zero downtime. That being said, we still had only 0.5 CPUs and a 512MB of memory.</p><p>Many optimizations were done that patched the problem, but none addressed the underlying issue, which was an unoptimized backend written in Python and running on a server that was not powerful enough. The backend was memory constrained, thus often forcing a restart. The initial optimizations to the Python backend (not listed here) were enough to keep our users happy, who said they didn&rsquo;t notice the issues and liked how it had all of the grade data they wanted.</p><p>That was until recently. Our traffic has increased substantially and we added a vector search. The addition of the search has meant that both our memory and CPU are not enough to handle the traffic. This leads us to the most recent optimizations to reduce the amount of memory needed, as well as increase the speed of the endpoints.</p><p>We initially wrote our backend in Python and FastAPI to quickly validate our product with our target market. We actually didn&rsquo;t realize that students wanted grade data to begin with. We only discovered this after speaking with our users who were already enjoying the early version of our class search.</p><p>Repositioning our product to focus on grade data was a huge success and we have gained significant traction since then. Both the traction and the addition of computationally complex features like vector search, meant that we have outgrown our original solution.</p><div id=the-optimizations class=anchor></div><h2 class="relative group">The Optimizations
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-optimizations aria-label=Anchor>#</a></span></h2><div id=optimization-1-moving-to-rust class=anchor></div><h3 class="relative group">Optimization 1: Moving to Rust
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optimization-1-moving-to-rust aria-label=Anchor>#</a></span></h3><p>The route that served data for all courses on the old backend was called <code>all_courses</code>. The initial time of the route to send the 4MB of data was <code>6.369</code> seconds. This was calculated as an average of 50 total runs (see <a href=#methods>methods section</a>).</p><p>The first optimization was to rewrite the <code>all_courses</code> route in Rust and host it on a VPS. I went with a Linode server with the following specs:</p><pre tabindex=0><code>OS: Debian GNU/Linux 11 (bullseye) x86_64
Host: Compute Instance
Kernel: 5.10.0-30-amd64
Uptime: 353 days, 3 hours, 53 mins
Packages: 826 (dpkg)
Shell: bash 5.1.4
Resolution: 1280x800
CPU: AMD EPYC 7642 (1) @ 2.300GHz
GPU: 00:01.0 Vendor 1234 Device 1111
Memory: 271MiB / 1971MiB
</code></pre><p>The new route loads a JSON file called <code>./all_courses.json</code>, parses it, and returns the serialized data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>extern</span><span class=w> </span><span class=k>crate</span><span class=w> </span><span class=n>rocket</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>rocket</span>::<span class=n>routes</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[get(</span><span class=s>&#34;/courses&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_all_courses_json_load</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Json</span><span class=o>&lt;</span><span class=n>Value</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>json_string</span>: <span class=nb>String</span> <span class=o>=</span><span class=w> </span><span class=n>fs</span>::<span class=n>read_to_string</span><span class=p>(</span><span class=s>&#34;./all_courses.json&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=k>await</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;Should have read json file.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>from_str</span>::<span class=o>&lt;</span><span class=n>Value</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>json_string</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>json</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>Json</span><span class=p>(</span><span class=n>json</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Err</span><span class=p>(</span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>Json</span><span class=p>(</span><span class=n>serde_json</span>::<span class=n>json</span><span class=o>!</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>{</span><span class=s>&#34;error&#34;</span>: <span class=s>&#34;Invalid JSON in GLOBAL_STRING&#34;</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The main function sets up the port, the address, and the routes. I used <a href=https://rocket.rs/ target=_blank>Rocket.rs</a> as the backend framework.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[rocket::main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=n>rocket</span>::<span class=n>Error</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>figment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rocket</span>::<span class=n>Config</span>::<span class=n>figment</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>merge</span><span class=p>((</span><span class=s>&#34;port&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>8001</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>merge</span><span class=p>((</span><span class=s>&#34;address&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;0.0.0.0&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rocket</span>::<span class=n>custom</span><span class=p>(</span><span class=n>figment</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>mount</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;/courses/&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>routes</span><span class=o>!</span><span class=p>[</span><span class=n>get_all_courses_json_load</span><span class=p>,],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Note: All Rust code was run in release mode with <code>--release</code> [<a href=#notes>
1</a>].</p><p>After hosting on the Linode VPS, the route served the same data in <code>1.456</code> seconds. That&rsquo;s a <code>4.374x</code> increase in speed.</p><div class=chart><canvas id=chart-3-1757618014866951445></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-3-1757618014866951445"),n=new Chart(t,{type:"bar",data:{labels:["Render","File Load"],datasets:[{label:"Mean Execution Time (seconds)",data:[6.369174861059873,1.4560875743400903],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"Performance Metrics: Mean Execution Time",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.2591171410731346,.6346429647144839],n=t[e.dataIndex];return`Std Dev: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"Routes",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.2591171410731346,.6346429647144839],o=[6.369174861059873,1.4560875743400903];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><p>Rust is obviously very fast, but actual execution speed of the code isn&rsquo;t the only limiting factor. We also need to be mindful of how and when we load this data from disk into memory.</p><div id=optimization-2-loading-json-to-memory-at-startup class=anchor></div><h3 class="relative group">Optimization 2: Loading JSON to memory at startup
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optimization-2-loading-json-to-memory-at-startup aria-label=Anchor>#</a></span></h3><p>This startup function loads the JSON data into a global string once at the start of the execution of the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>once_cell</span>::<span class=n>sync</span>::<span class=n>OnceCell</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>static</span><span class=w> </span><span class=n>GLOBAL_STRING</span>: <span class=nc>OnceCell</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OnceCell</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Load the JSON to a global string
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>startup_all_courses_string</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>json_string</span>: <span class=nb>String</span> <span class=o>=</span><span class=w> </span><span class=n>fs</span>::<span class=n>read_to_string</span><span class=p>(</span><span class=s>&#34;./all_courses.json&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=k>await</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;Should have read json file.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>GLOBAL_STRING</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=n>json_string</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This is the new route that uses that global string and returns the JSON data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#[get(</span><span class=s>&#34;/courses-json&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_all_courses_json</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Json</span><span class=o>&lt;</span><span class=n>Value</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GLOBAL_STRING</span><span class=p>.</span><span class=n>get</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>match</span><span class=w> </span><span class=n>from_str</span>::<span class=o>&lt;</span><span class=n>Value</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Ok</span><span class=p>(</span><span class=n>json</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>Json</span><span class=p>(</span><span class=n>json</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>Json</span><span class=p>(</span><span class=n>serde_json</span>::<span class=n>json</span><span class=o>!</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>{</span><span class=s>&#34;error&#34;</span>: <span class=s>&#34;Invalid JSON in GLOBAL_STRING&#34;</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Json</span><span class=p>(</span><span class=n>serde_json</span>::<span class=n>json</span><span class=o>!</span><span class=p>({</span><span class=s>&#34;message&#34;</span>: <span class=s>&#34;Not initialized yet...&#34;</span><span class=p>}))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Then we call the function in main at startup.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#[rocket::main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=n>rocket</span>::<span class=n>Error</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>startup_all_courses_string</span><span class=p>().</span><span class=k>await</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// -- snip --
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Loading the JSON to memory at start saves us from doing it each time the route is called.</p><p>The resulting speed was <code>1.425</code> with a <code>4.469x</code> speed increase.</p><p>Now with loading our file on startup, we can think about how we send the data back to the caller.</p><div id=optimization-3-using-rawjson class=anchor></div><h3 class="relative group">Optimization 3: Using RawJson
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optimization-3-using-rawjson aria-label=Anchor>#</a></span></h3><p>For this optimization, we just return the JSON as <code>RawJson</code> instead of the <code>Json</code> struct, so no serialization has to be done [<a href=#notes>
2</a>].</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[get(</span><span class=s>&#34;/courses&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_all_courses</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>RawJson</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GLOBAL_STRING</span><span class=p>.</span><span class=n>get</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RawJson</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RawJson</span><span class=p>(</span><span class=s>r#&#34;{&#34;message&#34;: &#34;Not initialized yet...&#34;}&#34;#</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Now the route runs in <code>1.550</code> seconds. A <code>4.109x</code> improvement from the original but not an improvement from the previous route.</p><div class=chart><canvas id=chart-4-1757618014866966463></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-4-1757618014866966463"),n=new Chart(t,{type:"bar",data:{labels:["JSON Memory","Raw JSON"],datasets:[{label:"Mean Execution Time (seconds)",data:[1.4252088000000003,1.5500796356199862],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"JSON Processing Performance Comparison",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.08349626759118409,.10216213479459138],n=t[e.dataIndex];return`Std Error: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"JSON Processing Methods",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.08349626759118409,.10216213479459138],o=[1.4252088000000003,1.5500796356199862];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><p>As you can see, the mean execution time of the routes are very similar. Moreover, their error bars tell us that these two are practically the same.</p><p>We can do a Two Sample T-Test for significance using Python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.stats</span> <span class=kn>import</span> <span class=n>ttest_ind</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>json_memory</span> <span class=o>=</span> <span class=p>[</span> <span class=p>]</span> <span class=c1># ... data given in appendix</span>
</span></span><span class=line><span class=cl><span class=n>raw_json</span> <span class=o>=</span> <span class=p>[</span> <span class=p>]</span> <span class=c1># ... data given in appendix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t_stat</span><span class=p>,</span> <span class=n>p_value</span> <span class=o>=</span> <span class=n>ttest_ind</span><span class=p>(</span><span class=n>json_memory</span><span class=p>,</span> <span class=n>raw_json</span><span class=p>,</span> <span class=n>equal_var</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>t_stat</span><span class=p>,</span> <span class=n>p_value</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=o>-</span><span class=mf>0.9368941557046255</span> <span class=mf>0.35120718054235234</span>
</span></span></code></pre></div><p>Since our p-value is <code>0.351</code> and greater than an alpha value of <code>0.05</code>, we can tell that these two execution times are not significantly different. It didn&rsquo;t significantly speed up or slow down execution time by using <code>RawJson</code> instead of the normal <code>Json</code>.</p><p>We&rsquo;ve figured out how to optimize by loading data into memory at startup, but we still need to be mindful of how much data we are sending. Right now, it&rsquo;s still 4MBs of data.</p><div id=optimization-4-gzip-data class=anchor></div><h3 class="relative group">Optimization 4: Gzip Data
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optimization-4-gzip-data aria-label=Anchor>#</a></span></h3><p>The next optimization is to use gzip to compress the file before it gets sent. Because it&rsquo;s sending less data, we can expect some amount of time improvement. When the route gets called, it loads a premade gzip file called <code>./all_courses.json.1.gz</code> and returns the data.</p><p>This is a Responder that tells the rocket framework that we mean to send binary data with the gzip Content-Encoding. When the endpoint gets called, the caller knows that this data is zipped, and that it should decompress it as it receives the data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=k>struct</span> <span class=nc>GzippedJson</span><span class=p>(</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[rocket::async_trait]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;&#39;</span><span class=na>r</span><span class=o>&gt;</span><span class=w> </span><span class=n>Responder</span><span class=o>&lt;&#39;</span><span class=na>r</span><span class=p>,</span><span class=w> </span><span class=o>&#39;</span><span class=nb>static</span><span class=o>&gt;</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>GzippedJson</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>respond_to</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>_</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>r</span> <span class=nc>Request</span><span class=o>&lt;&#39;</span><span class=nb>_</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>rocket</span>::<span class=n>response</span>::<span class=nb>Result</span><span class=o>&lt;&#39;</span><span class=nb>static</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Response</span>::<span class=n>build</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>header</span><span class=p>(</span><span class=n>ContentType</span>::<span class=n>JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>header</span><span class=p>(</span><span class=n>Header</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;Content-Encoding&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;gzip&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>sized_body</span><span class=p>(</span><span class=bp>self</span><span class=p>.</span><span class=mf>0.</span><span class=n>len</span><span class=p>(),</span><span class=w> </span><span class=n>Cursor</span>::<span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=p>.</span><span class=mi>0</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>ok</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Gzip has 9 levels of compression. Level 1 is the fastest to compress but also the worst compression. Level 9 is the best compression but the slowest. I made a route for each level to compare them to each other. This is the gzip level 1 route. There are also 8 other routes for each of the gzip levels (2-9).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#[get(</span><span class=s>&#34;/courses-gzip-1-inline&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_all_courses_gzip_one_inline</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>GzippedJson</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;./all_courses.json.1.gz&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>gzip_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>File</span>::<span class=n>open</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=k>await</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>file</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>file</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Err</span><span class=p>(</span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>Status</span>::<span class=n>InternalServerError</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>gzip_contents</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>gzip_file</span><span class=p>.</span><span class=n>read_to_end</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>gzip_contents</span><span class=p>).</span><span class=k>await</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>GzippedJson</span><span class=p>(</span><span class=n>gzip_contents</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Err</span><span class=p>(</span><span class=n>_</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>Status</span>::<span class=n>InternalServerError</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The best one was Gzip level 8, which took <code>0.781</code> seconds to run. This resulted in a <code>8.154x</code> speedup from the original. Other than the Gzip level 1, the execution times are basically the same. It&rsquo;s safe to say that the execution times with different levels of Gzip aren&rsquo;t significantly different, especially given the error bars that are larger than the difference in the execution times.</p><div class=chart><canvas id=chart-5-1757618014866980940></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-5-1757618014866980940"),n=new Chart(t,{type:"bar",data:{labels:["Gzip Inline Clone 1","Gzip Inline Clone 9","Gzip Inline Clone 7","Gzip Inline Clone 4","Gzip Inline Clone 5","Gzip Inline Clone 3","Gzip Inline Clone 2","Gzip Inline Clone 6","Gzip Inline Clone 8"],datasets:[{label:"Mean Execution Time (seconds)",data:[.8368181653398278,.7810885166600565,.7824843093800155,.7765849953799989,.7773541713599843,.7633252797201203,.7555291458401189,.7452488209999137,.7432830796599592],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(255, 159, 64, 0.8)","rgba(255, 205, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(54, 162, 235, 0.8)","rgba(153, 102, 255, 0.8)","rgba(201, 203, 207, 0.8)","rgba(255, 99, 255, 0.8)","rgba(99, 255, 132, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(255, 159, 64, 1)","rgba(255, 205, 86, 1)","rgba(75, 192, 192, 1)","rgba(54, 162, 235, 1)","rgba(153, 102, 255, 1)","rgba(201, 203, 207, 1)","rgba(255, 99, 255, 1)","rgba(99, 255, 132, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"Gzip Inline Clone Performance Comparison",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.21327256608237583,.14640932449901906,.13508388551989717,.12879601537363955,.1590585490140576,.12866482693516748,.08742206467629585,.098992305811364,.09742097404424784],n=t[e.dataIndex];return`Std Dev: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"Clone Versions",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.21327256608237583,.14640932449901906,.13508388551989717,.12879601537363955,.1590585490140576,.12866482693516748,.08742206467629585,.098992305811364,.09742097404424784],o=[.8368181653398278,.7810885166600565,.7824843093800155,.7765849953799989,.7773541713599843,.7633252797201203,.7555291458401189,.7452488209999137,.7432830796599592];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><p>The main takeaway is, the level of Gzip here doesn&rsquo;t make a significant difference. That being said, Gzipped data vs. Non-Gzipped data does make a difference, as seen below.</p><div class=chart><canvas id=chart-6-1757618014867002661></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-6-1757618014867002661"),n=new Chart(t,{type:"bar",data:{labels:["Raw JSON","Gzip Inline Clone 8"],datasets:[{label:"Mean Execution Time (seconds)",data:[1.5500796356199862,.7432830796599592],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"Raw JSON vs Gzip Inline Clone 8 Performance",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.722395382937497,.09742097404424784],n=t[e.dataIndex];return`Std Dev: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"Processing Methods",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.722395382937497,.09742097404424784],o=[1.5500796356199862,.7432830796599592];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><div id=optimization-5-preloading-data-into-memory class=anchor></div><h3 class="relative group">Optimization 5: Preloading Data Into Memory
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#optimization-5-preloading-data-into-memory aria-label=Anchor>#</a></span></h3><p>We can use the technique developed in <a href=#optimization-2-loading-json-to-memory-at-startup>Optimization 2.</a> to preload data into memory at startup. This time, we are loading the gzip data into memory, instead of JSON data. The reason here is the same; to save time by not needing to load a file when the route gets called.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=k>static</span><span class=w> </span><span class=n>GZIPPED_COURSE_NINE</span>: <span class=nc>OnceCell</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OnceCell</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[get(</span><span class=s>&#34;/courses-gzip-9-preload&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_all_courses_gzip_nine_preload</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>GzippedJson</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>GZIPPED_COURSE_NINE</span><span class=p>.</span><span class=n>get</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Some</span><span class=p>(</span><span class=n>contents</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>GzippedJson</span><span class=p>(</span><span class=n>contents</span><span class=p>.</span><span class=n>clone</span><span class=p>())),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>None</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>Status</span>::<span class=n>InternalServerError</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The startup code loads the file from disk and stores it into the <code>OnceCell</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>startup</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// -- snip --
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>gzip_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>File</span>::<span class=n>open</span><span class=p>(</span><span class=s>&#34;./all_courses.json.9.gz&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=k>await</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;Failed to open gzip-9 file&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>gzip_contents</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>gzip_file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>read_to_end</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>gzip_contents</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=k>await</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;Failed to read gzip-9 file&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>GZIPPED_COURSE_SIX</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=n>gzip_contents</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>It took <code>0.778</code> seconds to run. This results in an <code>8.186x</code> speed improvement overall.</p><div class=chart><canvas id=chart-7-1757618014867017849></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-7-1757618014867017849"),n=new Chart(t,{type:"bar",data:{labels:["Gzip Clone 2","Gzip Clone 1","Gzip Clone 5","Gzip Clone 3","Gzip Clone 9","Gzip Clone 4","Gzip Clone 8","Gzip Clone 7","Gzip Clone 6"],datasets:[{label:"Mean Execution Time (seconds)",data:[.8160195315601232,.8156704822000029,.7998635946800278,.7973412051801279,.778301530739991,.7686760814599984,.7653455096598555,.7635946762201639,.7590478010600782],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(255, 159, 64, 0.8)","rgba(255, 205, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(54, 162, 235, 0.8)","rgba(153, 102, 255, 0.8)","rgba(201, 203, 207, 0.8)","rgba(255, 99, 255, 0.8)","rgba(99, 255, 132, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(255, 159, 64, 1)","rgba(255, 205, 86, 1)","rgba(75, 192, 192, 1)","rgba(54, 162, 235, 1)","rgba(153, 102, 255, 1)","rgba(201, 203, 207, 1)","rgba(255, 99, 255, 1)","rgba(99, 255, 132, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"Gzip Clone Performance Comparison",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.17127265854588763,.1996684951847336,.15271013845577763,.17403583257200395,.14202914245318102,.13397251071996905,.12246670577815581,.17856005247325293,.12213095194280894],n=t[e.dataIndex];return`Std Dev: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"Clone Versions",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.17127265854588763,.1996684951847336,.15271013845577763,.17403583257200395,.14202914245318102,.13397251071996905,.12246670577815581,.17856005247325293,.12213095194280894],o=[.8160195315601232,.8156704822000029,.7998635946800278,.7973412051801279,.778301530739991,.7686760814599984,.7653455096598555,.7635946762201639,.7590478010600782];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><p>You can see here that there still isn&rsquo;t a significant difference in the execution time by Gzip level.</p><div id=bonus-optimization-attempts class=anchor></div><h2 class="relative group">Bonus Optimization Attempts
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bonus-optimization-attempts aria-label=Anchor>#</a></span></h2><p>These are attempted optimizations that had no significant effect for this use case, but I still wanted to mention them.</p><div id=attempt-1-using-owned-data class=anchor></div><h3 class="relative group">Attempt 1: Using Owned Data
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#attempt-1-using-owned-data aria-label=Anchor>#</a></span></h3><p>I tried to improve the speed by not cloning the data, but this didn&rsquo;t have any significant speedup.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rs data-lang=rs><span class=line><span class=cl><span class=cp>#[get(</span><span class=s>&#34;/courses-gzip-6-preload-own&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_all_courses_gzip_six_preload_own</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>GzippedJson</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>GZIPPED_COURSE_SIX</span><span class=p>.</span><span class=n>get</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Some</span><span class=p>(</span><span class=n>contents</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>GzippedJson</span><span class=p>(</span><span class=n>contents</span><span class=p>.</span><span class=n>to_owned</span><span class=p>())),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>None</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>Status</span>::<span class=n>InternalServerError</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This route swaps <code>contents.clone()</code> with <code>contents.to_owned()</code>, and we expect it to speed up because it avoids copying memory. However, copying memory is so quick, it&rsquo;s lost in the noise of the speed tests and is not significant here.</p><p>Here is a comparison of the best from optimization 3, optimization 4, and this attempt. The values are not significantly different.</p><div class=chart><canvas id=chart-8-1757618014867030854></canvas>
<script type=text/javascript>window.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("chart-8-1757618014867030854"),n=new Chart(t,{type:"bar",data:{labels:["Gzip Clone 6","Gzip Inline Clone 8","Gzip Own 9"],datasets:[{label:"Mean Execution Time (seconds)",data:[.7590478010600782,.7432830796599592,.7445368937799867],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)","rgba(255, 206, 86, 0.8)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,onResize:function(e){window.innerWidth<=768?e.canvas.parentNode.style.height="300px":e.canvas.parentNode.style.height="400px"},plugins:{title:{display:!0,text:"Gzip Performance Comparison: Top 3 Methods",color:"#e0e0e0"},legend:{onClick:null,labels:{color:"#e0e0e0",boxWidth:0}},tooltip:{backgroundColor:"rgba(40, 40, 40, 0.9)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"#666666",borderWidth:1,callbacks:{afterLabel:function(e){const t=[.12213095194280894,.09742097404424784,.11279561023598754],n=t[e.dataIndex];return`Std Dev: ±${n.toFixed(3)} seconds`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (seconds)",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}},x:{title:{display:!0,text:"Gzip Methods",color:"#e0e0e0"},ticks:{color:"#b0b0b0"},grid:{color:"#404040"},border:{color:"#666666"}}}},plugins:[{afterDatasetsDraw:function(e){const t=e.ctx,n=e.getDatasetMeta(0),s=[.12213095194280894,.09742097404424784,.11279561023598754],o=[.7590478010600782,.7432830796599592,.7445368937799867];n.data.forEach((n,i)=>{const l=s[i],d=o[i],a=n.x,u=e.scales.y,r=u.getPixelForValue(d+l),c=u.getPixelForValue(d-l);t.save(),t.strokeStyle="#cccccc",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(a,c),t.stroke(),t.beginPath(),t.moveTo(a-8,r),t.lineTo(a+8,r),t.stroke(),t.beginPath(),t.moveTo(a-8,c),t.lineTo(a+8,c),t.stroke(),t.restore()})}}]})})</script></div><div id=attempt-2-compiler-flags class=anchor></div><h3 class="relative group">Attempt 2: Compiler Flags
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#attempt-2-compiler-flags aria-label=Anchor>#</a></span></h3><p>Using compiler flags can optimize Rust and was effective in <a href="https://github.com/JakeRoggenbuck/RedoxQL?tab=readme-ov-file#using-rust-compilation-flags" target=_blank>RedoxQL</a> but when the performance of an API has a lot of noise due to sending the data over the wire, the optimizations have to be rather large to show significant and consistent results. I couldn&rsquo;t find any speed improvements with better compiler flags, but there also wasn&rsquo;t any regression.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>profile</span><span class=p>.</span><span class=nx>release</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>codegen-units</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nx>lto</span> <span class=p>=</span> <span class=s2>&#34;fat&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>opt-level</span> <span class=p>=</span> <span class=mi>3</span>
</span></span></code></pre></div><p>If compilation speed is not a concern, I&rsquo;d recommend using these compiler flags for performance intensive use cases.</p><div id=methods class=anchor></div><h2 class="relative group">Methods
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#methods aria-label=Anchor>#</a></span></h2><p>I ran a Python get request with the requests library for each of the routes 50 times to get a bunch of <a href=../../cdn/api-benchmark-results.json>raw data</a>.</p><p>Here is exactly how those requests were made:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_request</span><span class=p>(</span><span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error making request to </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=s2>&#34;inf&#34;</span><span class=p>)</span>
</span></span></code></pre></div><div id=conclusion class=anchor></div><h2 class="relative group">Conclusion
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>We improved the speed of fetching all courses by 8x. Going from <code>6.369</code> seconds to <code>0.743</code> seconds. <code>6.369 / 0.743 = 8.572</code>.</p><p>Gzipping the data was the most effective optimization, while using RawJson wasn&rsquo;t effective. My recommendation is to Gzip large data to get pretty impactful results. Going from over 6 seconds to less than 1 second is pretty impactful from a users perspective. Combine this with loading techniques like prefetching, and you have a categorically different user experience. One where a user is stuck watching a loading bar, and another where the page loads before you notice it started loading [<a href=#notes>
3</a>].</p><p>If you have any questions or feedback, please send me an email at <a href=mailto:me@jr0.org>me@jr0.org</a>.</p><div id=final-performance-rankings class=anchor></div><h2 class="relative group">Final Performance Rankings
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#final-performance-rankings aria-label=Anchor>#</a></span></h2><table><thead><tr><th>Rank</th><th>Endpoint</th><th>Mean Time (seconds)</th><th>Speedup vs Original</th></tr></thead><tbody><tr><td>1</td><td>Gzip Inline Clone 8</td><td>0.743</td><td>8.57x</td></tr><tr><td>2</td><td>Zopfli Clone [<a href=#notes>
4</a>]</td><td>0.744</td><td>8.56x</td></tr><tr><td>3</td><td>Gzip Own 9</td><td>0.745</td><td>8.55x</td></tr><tr><td>4</td><td>Gzip Inline Clone 6</td><td>0.745</td><td>8.55x</td></tr><tr><td>5</td><td>Gzip Own 4</td><td>0.751</td><td>8.48x</td></tr></tbody></table><div id=acknowledgments class=anchor></div><h2 class="relative group">Acknowledgments
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#acknowledgments aria-label=Anchor>#</a></span></h2><p>Thanks to Miles Kerr, Adam Hutchings, and Jamie Z Fox for proofreading drafts of this post.</p><div id=notes class=anchor></div><h2 class="relative group">Notes
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#notes aria-label=Anchor>#</a></span></h2><ol><li><p>I didn&rsquo;t test the difference here, but you can refer to <a href="https://github.com/JakeRoggenbuck/RedoxQL?tab=readme-ov-file#using-maturin-in-release-mode" target=_blank>experiments</a> done for <a href=https://github.com/JakeRoggenbuck/RedoxQL target=_blank>RedoxQL</a> to learn more about how release mode affects execution time.</p></li><li><p>The <code>RawJson</code> struct does not serialize the JSON but the <code>Json</code> struct does. &ldquo;Unlike types like Json and MsgPack, this type does not serialize data in any way.&rdquo; - <a href=https://api.rocket.rs/master/rocket/response/content/struct.RawJson target=_blank>Rocket Docs</a>.</p></li><li><p>Exploring methods of loading like prefetching and pagination was out of scope for this analysis, but I would like to write about other experiments I have conducted involving those topics.</p></li><li><p>I experimented with <a href=https://github.com/google/zopfli target=_blank>Zopfli</a> at the tail end of this experiment. It ended up getting second place! The content about Zopfli was very expansive and could be its own writeup. For now I&rsquo;ll leave it as a mention, but I plan to make an entire post about the different compression methods.</p></li></ol><div id=appendix class=anchor></div><h2 class="relative group">Appendix
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#appendix aria-label=Anchor>#</a></span></h2><div id=complete-two-sample-t-test-for-optimization-3-usign-rawjson class=anchor></div><h3 class="relative group">Complete Two Sample T-Test for Optimization 3. Usign RawJson
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#complete-two-sample-t-test-for-optimization-3-usign-rawjson aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.stats</span> <span class=kn>import</span> <span class=n>ttest_ind</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>json_memory</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.973679357999572</span><span class=p>,</span> <span class=mf>1.3670712690000073</span><span class=p>,</span> <span class=mf>0.9643661219997739</span><span class=p>,</span> <span class=mf>0.9589273820001836</span><span class=p>,</span> <span class=mf>1.320787708998978</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.7867885819996445</span><span class=p>,</span> <span class=mf>2.1966231890000927</span><span class=p>,</span> <span class=mf>0.9978538650011615</span><span class=p>,</span> <span class=mf>0.9183761020012753</span><span class=p>,</span> <span class=mf>1.9561643500001082</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>3.9334146049986884</span><span class=p>,</span> <span class=mf>1.5334536250011297</span><span class=p>,</span> <span class=mf>1.3566588120011147</span><span class=p>,</span> <span class=mf>0.9345785389996308</span><span class=p>,</span> <span class=mf>0.9412280389988155</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.5230459159993188</span><span class=p>,</span> <span class=mf>0.997932452999521</span><span class=p>,</span> <span class=mf>1.5062355209993257</span><span class=p>,</span> <span class=mf>0.9602563439984806</span><span class=p>,</span> <span class=mf>1.0653352389999782</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.0917232089996105</span><span class=p>,</span> <span class=mf>1.2183162040000752</span><span class=p>,</span> <span class=mf>1.6431986409988895</span><span class=p>,</span> <span class=mf>1.1045507960006944</span><span class=p>,</span> <span class=mf>0.9716254559989466</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.1503582229997846</span><span class=p>,</span> <span class=mf>1.389987807999205</span><span class=p>,</span> <span class=mf>0.9709620020003058</span><span class=p>,</span> <span class=mf>1.5604871830000775</span><span class=p>,</span> <span class=mf>2.2930652579998423</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.942650295999556</span><span class=p>,</span> <span class=mf>0.9267481040005805</span><span class=p>,</span> <span class=mf>1.7459450650003419</span><span class=p>,</span> <span class=mf>1.2209130920000462</span><span class=p>,</span> <span class=mf>2.2799626249998255</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.9559858960001293</span><span class=p>,</span> <span class=mf>1.182747857999857</span><span class=p>,</span> <span class=mf>1.0088869869996415</span><span class=p>,</span> <span class=mf>0.980577695001557</span><span class=p>,</span> <span class=mf>0.9660908070000005</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.394058343001234</span><span class=p>,</span> <span class=mf>1.684433843000079</span><span class=p>,</span> <span class=mf>1.0186395960008667</span><span class=p>,</span> <span class=mf>2.390076584999406</span><span class=p>,</span> <span class=mf>1.9315037920005125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.4616654729998118</span><span class=p>,</span> <span class=mf>1.4667386969995277</span><span class=p>,</span> <span class=mf>1.116512018001231</span><span class=p>,</span> <span class=mf>1.0006281990008574</span><span class=p>,</span> <span class=mf>0.9986232280007243</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>raw_json</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.986280318998979</span><span class=p>,</span> <span class=mf>0.9647047069993278</span><span class=p>,</span> <span class=mf>0.9699908290003805</span><span class=p>,</span> <span class=mf>2.1129850659999647</span><span class=p>,</span> <span class=mf>1.9638895680000132</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.024932837999586</span><span class=p>,</span> <span class=mf>4.000287509999907</span><span class=p>,</span> <span class=mf>1.145226298000125</span><span class=p>,</span> <span class=mf>1.699698824000734</span><span class=p>,</span> <span class=mf>0.9908221770001546</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.944178562000161</span><span class=p>,</span> <span class=mf>2.5993502880010055</span><span class=p>,</span> <span class=mf>2.2203835569998773</span><span class=p>,</span> <span class=mf>0.9601546530011547</span><span class=p>,</span> <span class=mf>2.229055272999176</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>1.0767834399994172</span><span class=p>,</span> <span class=mf>1.2358158110000659</span><span class=p>,</span> <span class=mf>1.8954839310008538</span><span class=p>,</span> <span class=mf>1.18127981500038</span><span class=p>,</span> <span class=mf>1.0515594850003254</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.9852659079988371</span><span class=p>,</span> <span class=mf>1.7373830760006967</span><span class=p>,</span> <span class=mf>1.078411574000711</span><span class=p>,</span> <span class=mf>0.9994106739995914</span><span class=p>,</span> <span class=mf>1.0001291019998462</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.9248236130006262</span><span class=p>,</span> <span class=mf>0.9887205659997562</span><span class=p>,</span> <span class=mf>2.8722692739993363</span><span class=p>,</span> <span class=mf>2.3793667789996107</span><span class=p>,</span> <span class=mf>1.688837734000117</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.9335982389984565</span><span class=p>,</span> <span class=mf>0.9394982150006399</span><span class=p>,</span> <span class=mf>1.1602229649997753</span><span class=p>,</span> <span class=mf>1.1103510649991222</span><span class=p>,</span> <span class=mf>1.044588010001462</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.265577234999</span><span class=p>,</span> <span class=mf>0.9528218729992659</span><span class=p>,</span> <span class=mf>1.8993646700000681</span><span class=p>,</span> <span class=mf>0.9858409770004073</span><span class=p>,</span> <span class=mf>2.3756143909995444</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>0.9791382849998627</span><span class=p>,</span> <span class=mf>1.0756488120005088</span><span class=p>,</span> <span class=mf>0.9240656319998379</span><span class=p>,</span> <span class=mf>1.5749800439989485</span><span class=p>,</span> <span class=mf>2.3650469929998508</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mf>2.6156799719992705</span><span class=p>,</span> <span class=mf>1.2122116750015266</span><span class=p>,</span> <span class=mf>1.886391308000384</span><span class=p>,</span> <span class=mf>3.4249254900005326</span><span class=p>,</span> <span class=mf>1.870934679000129</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t_stat</span><span class=p>,</span> <span class=n>p_value</span> <span class=o>=</span> <span class=n>ttest_ind</span><span class=p>(</span><span class=n>json_memory</span><span class=p>,</span> <span class=n>raw_json</span><span class=p>,</span> <span class=n>equal_var</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>t_stat</span><span class=p>,</span> <span class=n>p_value</span><span class=p>)</span>
</span></span></code></pre></div><p>Result:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=o>-</span><span class=mf>0.9368941557046255</span> <span class=mf>0.35120718054235234</span>
</span></span></code></pre></div><div id=api-routes-requested-by-week class=anchor></div><h3 class="relative group">API Routes Requested by Week
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#api-routes-requested-by-week aria-label=Anchor>#</a></span></h3><p>Here is a graph of the endpoints hit from January 2025 - August 2025 by week.</p><p><figure><img class="my-0 rounded-md" src=../../images/endspoint-requests.png alt="endspoint requests"></figure></p><div id=analytics-of-the-course-search class=anchor></div><h3 class="relative group">Analytics of the Course Search
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#analytics-of-the-course-search aria-label=Anchor>#</a></span></h3><p>Here is a graph of the unique users from January 2025 - August 2025 by week.</p><p><figure><img class="my-0 rounded-md" src=../../images/analytics.png alt=Analytics></figure></p></div></div><script>var oid="views_posts/optimizing-course-api.md",oid_likes="likes_posts/optimizing-course-api.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/using-regex-with-express/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Using Regex with Express</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-07-12 00:00:00 +0000 UTC">12 July 2025</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/posts/exakta-lens-sony-camera/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Exakta Lens on a Modern Sony Camera</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-08-23 00:00:00 +0000 UTC">23 August 2025</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Jake Roggenbuck</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>