{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML -}}
<urlset
  xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:image="http://www.google.com/schemas/sitemap-image/1.1">

{{- range .Sites }}
  {{- $baseURL := "https://jr0.org" -}}
  {{- /* Include home page first */ -}}
  {{- with .Home }}
  {{- $url := printf "%s%s" $baseURL .RelPermalink -}}
  <url>
    <loc>{{ $url }}</loc>

    {{- with .Lastmod }}
    <lastmod>{{ .Format "2006-01-02T15:04:05-07:00" }}</lastmod>
    {{- end }}

    {{- /* Add images from markdown front matter + page bundles */ -}}
    {{- $resources := .Resources.ByType "image" -}}
    {{- range $resources }}
    {{- $imgUrl := printf "%s%s" $baseURL .RelPermalink -}}
    <image:image>
      <image:loc>{{ $imgUrl }}</image:loc>
      {{- with .Title }}<image:title>{{ . }}</image:title>{{ end }}
    </image:image>
    {{- end }}
    {{- /* Add images from front matter */ -}}
    {{- with .Params.images -}}
    {{- range . }}
    <image:image>
      <image:loc>{{ if hasPrefix . "http" }}{{ . }}{{ else }}{{ printf "%s%s" $baseURL . }}{{ end }}</image:loc>
    </image:image>
    {{- end }}
    {{- end }}

  </url>
  {{- end }}

  {{- /* Include all regular pages */ -}}
  {{- range .RegularPages }}
  {{- $url := printf "%s%s" $baseURL .RelPermalink -}}
  <url>
    <loc>{{ $url }}</loc>

    {{- with .Lastmod }}
    <lastmod>{{ .Format "2006-01-02T15:04:05-07:00" }}</lastmod>
    {{- end }}

    {{- /* Add images from markdown front matter + page bundles */ -}}
    {{- $resources := .Resources.ByType "image" -}}
    {{- range $resources }}
    {{- $imgUrl := printf "%s%s" $baseURL .RelPermalink -}}
    <image:image>
      <image:loc>{{ $imgUrl }}</image:loc>
      {{- with .Title }}<image:title>{{ . }}</image:title>{{ end }}
    </image:image>
    {{- end }}
    {{- /* Add images from front matter */ -}}
    {{- with .Params.images -}}
    {{- range . }}
    <image:image>
      <image:loc>{{ if hasPrefix . "http" }}{{ . }}{{ else }}{{ printf "%s%s" $baseURL . }}{{ end }}</image:loc>
    </image:image>
    {{- end }}
    {{- end }}

  </url>
  {{- end }}
{{- end }}

</urlset>
